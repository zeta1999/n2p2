

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>LAMMPS NNP pair style &mdash; n2p2 - A neural network potential package 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NNP training procedure" href="training.html" />
    <link rel="prev" title="LAMMPS NNP interface" href="if_lammps.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> n2p2 - A neural network potential package
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Overview</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="build.html">Build instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="descriptors.html">Atomic environment descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="keywords.html">NNP configuration: keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="cfg_file.html">Configuration file format</a></li>
<li class="toctree-l1"><a class="reference internal" href="if_lammps.html">LAMMPS NNP interface</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">LAMMPS NNP pair style</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#pair-style-nnp-command">pair_style nnp command</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#syntax">Syntax</a></li>
<li class="toctree-l3"><a class="reference internal" href="#examples">Examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#description">Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="#restrictions">Restrictions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#related-commands">Related commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#default">Default</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="training.html">NNP training procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Tools/libnnp.html">The libnnp core library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/nnp-convert.html">nnp-convert</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/nnp-norm.html">nnp-norm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/nnp-predict.html">nnp-predict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/nnp-prune.html">nnp-prune</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/nnp-select.html">nnp-select</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/nnp-scaling.html">nnp-scaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/nnp-train.html">nnp-train</a></li>
</ul>
<p class="caption"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../About/authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../About/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../About/changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">n2p2 - A neural network potential package</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>LAMMPS NNP pair style</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Topics/pair_nnp.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="lammps-nnp-pair-style">
<span id="pair-nnp"></span><h1>LAMMPS NNP pair style<a class="headerlink" href="#lammps-nnp-pair-style" title="Permalink to this headline">¶</a></h1>
<div class="section" id="pair-style-nnp-command">
<h2>pair_style nnp command<a class="headerlink" href="#pair-style-nnp-command" title="Permalink to this headline">¶</a></h2>
<div class="section" id="syntax">
<h3>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pair_style nnp keyword value ...
</pre></div>
</div>
<ul>
<li><p>zero or more keyword/value pairs may be appended</p></li>
<li><p>keyword = <em>dir</em> or <em>showew</em> or <em>showewsum</em> or <em>maxew</em> or <em>resetew</em> or <em>cflength</em> or <em>cfenergy</em></p></li>
<li><p>value depends on the preceding keyword:</p>
<ul>
<li><p><em>emap</em> value = mapping</p>
<blockquote>
<div><p>mapping = Element mapping from LAMMPS atom types to n2p2 elements</p>
</div></blockquote>
</li>
<li><p><em>dir</em> value = directory</p>
<blockquote>
<div><p>directory = Path to NNP configuration files</p>
</div></blockquote>
</li>
<li><p><em>showew</em> value = <em>yes</em> or <em>no</em></p></li>
<li><p><em>showewsum</em> value = summary</p>
<blockquote>
<div><p>summary = Write EW summary every this many timesteps (<em>0</em> turns summary off)</p>
</div></blockquote>
</li>
<li><p><em>maxew</em> value = threshold</p>
<blockquote>
<div><p>threshold = Maximum number of EWs allowed</p>
</div></blockquote>
</li>
<li><p><em>resetew</em> value = <em>yes</em> or <em>no</em></p></li>
<li><p><em>cflength</em> value = length</p>
<blockquote>
<div><p>length = Length unit conversion factor</p>
</div></blockquote>
</li>
<li><p><em>cfenergy</em> value = energy</p>
<blockquote>
<div><p>energy = Energy unit conversion factor</p>
</div></blockquote>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pair_style nnp showew yes showewsum 100 maxew 1000 resetew yes cflength 1.8897261328 cfenergy 0.0367493254 emap &quot;1:H,2:O&quot;

pair_style nnp dir &quot;./&quot; showewsum 10000

pair_coeff * * 6.01
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Only use a single <cite>pair_style nnp</cite> line in your LAMMPS script.</p>
</div>
</div>
<div class="section" id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h3>
<p>This pair style adds an interaction based on the high-dimensional neural network
potential method <a class="footnote-reference brackets" href="#id4" id="id1">1</a>. These potentials must
be carefully trained to reproduce the potential energy surface in the desired
phase-space region prior to their usage in an MD simulation. This pair style
uses an interface to the NNP library <a class="footnote-reference brackets" href="#id5" id="id2">2</a> <a class="footnote-reference brackets" href="#id6" id="id3">3</a>, see the documentation
there for more information.</p>
<p>The maximum cutoff radius of all symmetry functions is the only argument of the
<em>pair_coeff</em> command which should be invoked with asterisk wild-cards only:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pair_coeff * * cutoff
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The cutoff must be given in LAMMPS length units, even if the neural network
potential has been trained using a different unit system (see remarks about the
<em>cflength</em> and <em>cfenergy</em> keywords below for details).</p>
</div>
<p>The numeric value may be slightly larger than the actual maximum symmetry
function cutoff radius (to account for rounding errors when converting units),
but must not be smaller.</p>
<hr class="docutils" />
<p>If provided, the keyword <em>emap</em> determines the mapping from LAMMPS atom types to
n2p2 elements. The format is a comma-separated list of <code class="docutils literal notranslate"><span class="pre">atom</span> <span class="pre">type:element</span></code>
pairs, e.g. <code class="docutils literal notranslate"><span class="pre">&quot;1:Cu,2:Zn&quot;</span></code> will map atom types 1 and 2 to elements Cu and Zn,
respectively. Atom types not present in the list will be completely ignored by
the NNP. The keyword <em>emap</em> is mandatory in a “hybrid” setup (see <a class="reference external" href="https://lammps.sandia.gov/doc/pair_hybrid.html">pair_hybrid</a>) with “extra” atom types in
the simulation which are not handled by the NNP.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Without an explicit mapping it is by default assumed that the atom type
specifications in LAMMPS configuration files are consistent with the ordering
of elements in the NNP library. Thus, without the <em>emap</em> keyword present
atom types must be sorted in order of ascending atomic number, e.g. the only
correct mapping for a configuration containing hydrogen, oxygen and zinc
atoms would be:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 24%" />
<col style="width: 41%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Element</p></th>
<th class="head"><p>Atomic number</p></th>
<th class="head"><p>LAMMPS type</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>H</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>O</p></td>
<td><p>8</p></td>
<td><p>2</p></td>
</tr>
<tr class="row-even"><td><p>Zn</p></td>
<td><p>30</p></td>
<td><p>3</p></td>
</tr>
</tbody>
</table>
</div>
<p>Use the <em>dir</em> keyword to specify the directory containing the NNP configuration
files. The directory must contain “input.nn” with neural network
and symmetry function setup, “scaling.data” with symmetry function scaling data
and “weights.???.data” with weight parameters for each element.</p>
<p>The keyword <em>showew</em> can be used to turn on/off the display of extrapolation
warnings (EWs) which are issued whenever a symmetry function value is out of
bounds defined by minimum/maximum values in “scaling.data”. An extrapolation
warning may look like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>### NNP EXTRAPOLATION WARNING ### STRUCTURE:      2 ATOM:     36 SYMFUNC:   14 VALUE:  8.978E-02 MIN:  3.900E-08 MAX:  8.888E-02
</pre></div>
</div>
<p>stating that the value 8.978E-02 of symmetry function 14 was out of bounds
(maximum in “scaling.data” is 8.888E-02) for atom 36. Here, the structure index
refers to the MPI rank.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <em>showew</em> keyword should only be set to <em>yes</em> for debugging purposes.
Extrapolation warnings may add lots of overhead as they are communicated each
timestep. Also, if the simulation is run in a phase-space region where the NNP
was not correctly trained, lots of extrapolation warnings may clog log files and
the console. In a production run use <em>showewsum</em> instead.</p>
</div>
<p>The keyword <em>showewsum</em> can be used to get an overview of extrapolation warnings
occurring during an MD simulation. The argument specifies the interval at which
extrapolation warning summaries are displayed and logged. An EW summary may look
like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>### NNP EW SUMMARY ### TS:        100 EW         11 EWPERSTEP  1.100E-01
</pre></div>
</div>
<p>Here, at timestep 100 the occurrence of 11 extrapolation warnings since the last
summary is reported, which corresponds to an EW rate of 0.11 per timestep.
Setting <em>showewsum</em> to 0 deactivates the EW summaries.</p>
<p>A maximum number of allowed extrapolation warnings can be specified with the
<em>maxew</em> keyword. If the number of EWs exceeds the <em>maxew</em> argument the
simulation is stopped. Note however that this is merely an approximate threshold
since the check is only performed at the end of each timestep and each MPI
process counts individually to minimize communication overhead.</p>
<p>The keyword <em>resetew</em> alters the behavior of the above mentioned <em>maxew</em>
threshold. If <em>resetew</em> is set to <em>yes</em> the threshold is applied on a
per-timestep basis and the internal EW counters are reset at the beginning of
each timestep. With <em>resetew</em> set to <em>no</em> the counters accumulate EWs along the
whole trajectory.</p>
<p>If the training of a neural network potential has been performed with different
physical units for length and energy than those set in LAMMPS, it is still
possible to use the potential when the unit conversion factors are provided via
the <em>cflength</em> and <em>cfenergy</em> keywords. If for example, the NNP was
parameterized with Bohr and Hartree training data and symmetry function
parameters (i.e. distances and energies in “input.nn” are given in Bohr and
Hartree) but LAMMPS is set to use <em>metal</em> units (Angstrom and eV) the correct
conversion factors are:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cflength 1.8897261328

cfenergy 0.0367493254
</pre></div>
</div>
<p>Thus, arguments of <em>cflength</em> and <em>cfenergy</em> are the multiplicative factors
required to convert lengths and energies given in LAMMPS units to respective
quantities in native NNP units (1 Angstrom = 1.8897261328 Bohr, 1 eV =
0.0367493254 Hartree).</p>
</div>
<hr class="docutils" />
<div class="section" id="restrictions">
<h3>Restrictions<a class="headerlink" href="#restrictions" title="Permalink to this headline">¶</a></h3>
<p>Please report bugs and feature requests to the <a class="reference external" href="https://github.com/CompPhysVienna/n2p2/issues">n2p2 GitHub issue page</a>.</p>
</div>
<div class="section" id="related-commands">
<h3>Related commands<a class="headerlink" href="#related-commands" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://lammps.sandia.gov/doc/pair_coeff.html">pair_coeff</a></p>
<p><a class="reference external" href="https://lammps.sandia.gov/doc/pair_hybrid.html">pair_hybrid</a></p>
<p><a class="reference external" href="https://lammps.sandia.gov/doc/units.html">units</a></p>
</div>
<div class="section" id="default">
<h3>Default<a class="headerlink" href="#default" title="Permalink to this headline">¶</a></h3>
<p>The default options are <em>dir</em> = “nnp/”, <em>showew</em> = yes, <em>showewsum</em> = 0, <em>maxew</em>
= 0, <em>resetew</em> = no, <em>cflength</em> = 1.0, <em>cfenergy</em> = 1.0. The default atom type
mapping is determined automatically according to ascending atomic number of
present elements (see above).</p>
<hr class="docutils" />
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Behler, J.; Parrinello, M. Generalized Neural-Network Representation of
High-Dimensional Potential-Energy Surfaces. Phys. Rev. Lett. 2007, 98 (14),
146401. <a class="reference external" href="https://doi.org/10.1103/PhysRevLett.98.146401">https://doi.org/10.1103/PhysRevLett.98.146401</a></p>
</dd>
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p><a class="reference external" href="https://github.com/CompPhysVienna/n2p2">https://github.com/CompPhysVienna/n2p2</a></p>
</dd>
<dt class="label" id="id6"><span class="brackets"><a class="fn-backref" href="#id3">3</a></span></dt>
<dd><p>Singraber, A.; Morawietz, T.; Behler, J.; Dellago, C. Parallel
Multistream Training of High-Dimensional Neural Network Potentials. J. Chem.
Theory Comput. 2019, 15 (5), 3075–3092. <a class="reference external" href="https://doi.org/10.1021/acs.jctc.8b01092">https://doi.org/10.1021/acs.jctc.8b01092</a></p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="training.html" class="btn btn-neutral float-right" title="NNP training procedure" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="if_lammps.html" class="btn btn-neutral float-left" title="LAMMPS NNP interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Andreas Singraber

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>