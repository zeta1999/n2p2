

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Build instructions &mdash; n2p2 - A neural network potential package 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Atomic environment descriptors" href="descriptors.html" />
    <link rel="prev" title="Welcome to the documentation of n2p2!" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> n2p2 - A neural network potential package
          

          
          </a>

          
            
            
              <div class="version">
                1.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Overview</a></li>
</ul>
<p class="caption"><span class="caption-text">Topics</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Build instructions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#code-structure">Code structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-master-makefile">The master makefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="#individual-component-makefiles">Individual component makefiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="#project-wide-compilation-options">Project-wide compilation options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#symmetry-function-groups">Symmetry function groups</a></li>
<li class="toctree-l3"><a class="reference internal" href="#improved-symmetry-function-derivative-memory">Improved symmetry function derivative memory</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="descriptors.html">Atomic environment descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="keywords.html">NNP configuration: keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="cfg_file.html">Configuration file format</a></li>
<li class="toctree-l1"><a class="reference internal" href="if_lammps.html">LAMMPS NNP interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="pair_nnp.html">LAMMPS NNP pair style</a></li>
<li class="toctree-l1"><a class="reference internal" href="training.html">NNP training procedure</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units</a></li>
</ul>
<p class="caption"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Tools/libnnp.html">The libnnp core library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/nnp-convert.html">nnp-convert</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/nnp-norm.html">nnp-norm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/nnp-predict.html">nnp-predict</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/nnp-prune.html">nnp-prune</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/nnp-select.html">nnp-select</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/nnp-scaling.html">nnp-scaling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Tools/nnp-train.html">nnp-train</a></li>
</ul>
<p class="caption"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../About/authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../About/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../About/changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">n2p2 - A neural network potential package</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Build instructions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Topics/build.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="build-instructions">
<span id="build"></span><h1>Build instructions<a class="headerlink" href="#build-instructions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="code-structure">
<h2>Code structure<a class="headerlink" href="#code-structure" title="Permalink to this headline">¶</a></h2>
<p>This package contains multiple components with varying interdependencies and
dependencies on third-party libraries. You may not need to build all
components, this depends on the intended use. The following table lists all
components and their respective requirements (follow the links for more
information).</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 29%" />
<col style="width: 24%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Component</p></th>
<th class="head"><p>Requirements</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="../Tools/libnnp.html#libnnp"><span class="std std-ref">libnnp</span></a></p></td>
<td><p>C++11 compiler (icpc, g++)</p></td>
<td><p>NNP core library (NN, SF, Structure, …)</p></td>
</tr>
<tr class="row-odd"><td><p>libnnpif</p></td>
<td><p>libnnp, MPI</p></td>
<td><p>Interfaces to other software (LAMMPS, …)</p></td>
</tr>
<tr class="row-even"><td><p>libnnptrain</p></td>
<td><p>libnnp, MPI, GSL, Eigen</p></td>
<td><p>Dataset and training routines (Kalman, …).</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../Tools/nnp-convert.html#nnp-convert"><span class="std std-ref">nnp-convert</span></a></p></td>
<td><p>libnnp</p></td>
<td><p>Convert between structure file formats.</p></td>
</tr>
<tr class="row-even"><td><p>nnp-cutoff</p></td>
<td><p>libnnp</p></td>
<td><p>Test speed of different cutoff functions.</p></td>
</tr>
<tr class="row-odd"><td><p>nnp-dist</p></td>
<td><p>libnnp</p></td>
<td><p>Calculate radial and angular distribution functions.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../Tools/nnp-predict.html#nnp-predict"><span class="std std-ref">nnp-predict</span></a></p></td>
<td><p>libnnp</p></td>
<td><p>Predict energy and forces for one structure.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../Tools/nnp-prune.html#nnp-prune"><span class="std std-ref">nnp-prune</span></a></p></td>
<td><p>libnnp</p></td>
<td><p>Prune symmetry functions.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../Tools/nnp-select.html#nnp-select"><span class="std std-ref">nnp-select</span></a></p></td>
<td><p>libnnp</p></td>
<td><p>Select subset from data set.</p></td>
</tr>
<tr class="row-odd"><td><p>nnp-symfunc</p></td>
<td><p>libnnp</p></td>
<td><p>Symmetry function shape from settings file.</p></td>
</tr>
<tr class="row-even"><td><p>nnp-comp2</p></td>
<td><p>libnnptrain</p></td>
<td><p>Compare prediction of 2 NNPs for data set.</p></td>
</tr>
<tr class="row-odd"><td><p>nnp-dataset</p></td>
<td><p>libnnptrain</p></td>
<td><p>Calculate energies and forces for a whole data set.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../Tools/nnp-norm.html#nnp-norm"><span class="std std-ref">nnp-norm</span></a></p></td>
<td><p>libnnptrain</p></td>
<td><p>Calculate normalization factors for data set.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../Tools/nnp-scaling.html#nnp-scaling"><span class="std std-ref">nnp-scaling</span></a></p></td>
<td><p>libnnptrain</p></td>
<td><p>Calculate symmetry function values for data set.</p></td>
</tr>
<tr class="row-even"><td><p>nnp-train</p></td>
<td><p>libnnptrain</p></td>
<td><p>Train a neural network potential.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="if_lammps.html#if-lammps"><span class="std std-ref">lammps-nnp</span></a></p></td>
<td><p>libnnpif</p></td>
<td><p>Pair style <cite>nnp</cite> for LAMMPS</p></td>
</tr>
<tr class="row-even"><td><p>pynnp</p></td>
<td><p>libnnp, python, cython</p></td>
<td><p>Python interface to NNP library.</p></td>
</tr>
<tr class="row-odd"><td><p>doc</p></td>
<td><p>Sphinx, Doxygen, Exhale</p></td>
<td><p>Documentation.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="the-master-makefile">
<h2>The master makefile<a class="headerlink" href="#the-master-makefile" title="Permalink to this headline">¶</a></h2>
<p>A master makefile is provided in the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory which provides targets
for all individual components.  For instance, compiling the interface library
<code class="docutils literal notranslate"><span class="pre">libnnpif</span></code> requires only to type</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make libnnpif
</pre></div>
</div>
<p>in the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory. Similarly, to build the application <code class="docutils literal notranslate"><span class="pre">nnp-predict</span></code>
run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make nnp-predict
</pre></div>
</div>
<p>If an application depends on libraries, these will be built in advance
automatically. Compiled binaries will be copied to the <code class="docutils literal notranslate"><span class="pre">bin</span></code> path (relative to
the root directory), whereas libraries can be found in the <code class="docutils literal notranslate"><span class="pre">lib</span></code> folder.  To
clean up individual components use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make clean-&lt;component&gt;
</pre></div>
</div>
<p>or to clean everything (except documentation) use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make clean
</pre></div>
</div>
<p>By default, all libraries and applications will be built for static linking,
i.e <code class="docutils literal notranslate"><span class="pre">.a</span></code> versions of libraries and statically built versions of executables
are created. If dynamic linking is preferred use the <code class="docutils literal notranslate"><span class="pre">MODE=shared</span></code> switch as
additional argument of the make command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make <span class="nv">MODE</span><span class="o">=</span>shared nnp-predict
</pre></div>
</div>
<p>This will build <code class="docutils literal notranslate"><span class="pre">.so</span></code> versions of libraries and executables which require
dynamic linking at runtime. Do not forget to point your linker to the <code class="docutils literal notranslate"><span class="pre">lib</span></code>
directory, e.g. correctly set the environment variable <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code>.</p>
<p>There are three different choices for the <code class="docutils literal notranslate"><span class="pre">MODE</span></code> switch:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">static</span></code> (<em>default</em>): This is the default which is used when no mode is
explicitly set at the command line. Static build of libraries and
applications.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shared</span></code>: Use for dynamic linking, creates <code class="docutils literal notranslate"><span class="pre">.so</span></code> versions of libraries.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test</span></code>: Special builds for CI tests and coverage reports.</p></li>
</ul>
</div></blockquote>
<p>Currently the build process has been tested with two different compilers, the
GNU compiler g++ 5.4 (<code class="docutils literal notranslate"><span class="pre">gnu</span></code>) and the Intel compiler 17 (<code class="docutils literal notranslate"><span class="pre">intel</span></code>). It is
possible to switch between them via the <code class="docutils literal notranslate"><span class="pre">COMP</span></code> variable, e.g.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make libnnp <span class="nv">COMP</span><span class="o">=</span>intel
</pre></div>
</div>
<p>If you need to change compiler variables and paths have a look at the
corresponding makefiles containing global build parameters:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>src/makefile.gnu
src/makefile.intel
</pre></div>
</div>
<p>You can also create new parameter makefiles based on the above and change the
file name suffix according to your target:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>src/makefile.&lt;target&gt;
make libnnp <span class="nv">COMP</span><span class="o">=</span>&lt;target&gt;
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In contrast to earlier versions it is now safe to use the <cite>-j</cite> switch to
enable parallel compilation. By default only a single processor is used. For
instance, in order to use 4 processors to build all components type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make -j <span class="m">4</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="individual-component-makefiles">
<h2>Individual component makefiles<a class="headerlink" href="#individual-component-makefiles" title="Permalink to this headline">¶</a></h2>
<p>It is also possible to invoke individual makefiles for each component manually.
Just switch to the corresponding folder and use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">MODE=&lt;mode&gt;</span>
<span class="pre">COMP=&lt;target&gt;</span></code>. The global build parameters will be used from the
<code class="docutils literal notranslate"><span class="pre">src/makefile.&lt;target&gt;</span></code> file.</p>
</div>
<div class="section" id="project-wide-compilation-options">
<h2>Project-wide compilation options<a class="headerlink" href="#project-wide-compilation-options" title="Permalink to this headline">¶</a></h2>
<p>Each of the build parameter makefiles <code class="docutils literal notranslate"><span class="pre">src/makefile.&lt;target&gt;</span></code> contains a
section at the end which allows to enable/disable certain options at compile
time:</p>
<div class="section" id="symmetry-function-groups">
<h3>Symmetry function groups<a class="headerlink" href="#symmetry-function-groups" title="Permalink to this headline">¶</a></h3>
<p><strong>Flag:</strong> <code class="docutils literal notranslate"><span class="pre">-DNOSFGROUPS</span></code> (default: <em>disabled</em>)</p>
<p>If this flag is set the symmetry function group feature will be disabled
everywhere. This will result in a much worse performance but may be useful for
debugging and development purposes. Note that disabling symmetry function groups
will not change results, please see details in this publication <a class="footnote-reference brackets" href="#id2" id="id1">1</a>.</p>
</div>
<div class="section" id="improved-symmetry-function-derivative-memory">
<h3>Improved symmetry function derivative memory<a class="headerlink" href="#improved-symmetry-function-derivative-memory" title="Permalink to this headline">¶</a></h3>
<p><strong>Flag:</strong> <code class="docutils literal notranslate"><span class="pre">-DIMPROVED_SFD_MEMORY</span></code> (default: <em>enabled</em>)</p>
<p>Reduces the memory usage for symmetry function derivatives when multiple
elements are present. The actual reduction depends on the symmetry function
setup, as a rough estimate expect about 30 to 50% reduction. This feature is
particularly useful for training of large data sets when symmetry function
derivatives are stored in memory (keyword <code class="docutils literal notranslate"><span class="pre">memorize_symfunc_results</span></code>). An
additional section in the <a class="reference internal" href="../Tools/libnnp.html#libnnp"><span class="std std-ref">libnnp</span></a> output will displayed after
the <code class="docutils literal notranslate"><span class="pre">SETUP:</span> <span class="pre">SYMMETRY</span> <span class="pre">FUNCTIONS</span></code> section, which indicates the amount of
still required memory for symmetry function derivatives. Here is how the
output looks like for the RPBE-D3 water example
(<code class="docutils literal notranslate"><span class="pre">examples/nnp-predict/H2O_RPBE-D3</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>*** SETUP: SYMMETRY FUNCTION MEMORY *******************************************

Symmetry function derivatives memory table for element  H :
-------------------------------------------------------------------------------
Relevant symmetry functions for neighbors with element:
-  H:   15 of   27 ( 55.6 %)
-  O:   19 of   27 ( 70.4 %)
-------------------------------------------------------------------------------
Symmetry function derivatives memory table for element  O :
-------------------------------------------------------------------------------
Relevant symmetry functions for neighbors with element:
-  H:   18 of   30 ( 60.0 %)
-  O:   16 of   30 ( 53.3 %)
-------------------------------------------------------------------------------
*******************************************************************************
</pre></div>
</div>
<p>Benchmarking the training program and the LAMMPS interface with the same
system gives the following results:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 48%" />
<col style="width: 19%" />
<col style="width: 16%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="docutils literal notranslate"><span class="pre">-DIMPROVED_SFD_MEMORY</span></code></p></th>
<th class="head"><p><em>disabled</em></p></th>
<th class="head"><p><em>enabled</em></p></th>
<th class="head"><p>difference</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Training (memory)</p></td>
<td><p>55.2 GB</p></td>
<td><p>37.8 GB</p></td>
<td><p>-31.5 %</p></td>
</tr>
<tr class="row-odd"><td><p>MD with LAMMPS (memory)</p></td>
<td><p>725.6 MB</p></td>
<td><p>500.0 MB</p></td>
<td><p>-31.1 %</p></td>
</tr>
<tr class="row-even"><td><p>MD with LAMMPS (speed)</p></td>
<td><p>33.82 s</p></td>
<td><p>34.14 s</p></td>
<td><p>+0.9 %</p></td>
</tr>
</tbody>
</table>
<p>Given the significant reduction in memory and the negligible impact on speed
this feature is enabled by default.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If you prefer to disable this functionality please also remove the flag
<code class="docutils literal notranslate"><span class="pre">-DIMPROVED_SFD_MEMORY</span></code> from the LAMMPS makefile in
<code class="docutils literal notranslate"><span class="pre">src/libnnpif/Makefile.lammps</span></code>!</p>
</div>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Singraber, A.; Behler, J.; Dellago, C. Library-Based LAMMPS
Implementation of High-Dimensional Neural Network Potentials. J. Chem. Theory
Comput. 2019, 15 (3), 1827–1840. <a class="reference external" href="https://doi.org/10.1021/acs.jctc.8b00770">https://doi.org/10.1021/acs.jctc.8b00770</a></p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="descriptors.html" class="btn btn-neutral float-right" title="Atomic environment descriptors" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../index.html" class="btn btn-neutral float-left" title="Welcome to the documentation of n2p2!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Andreas Singraber

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>